# 実装計画

- [x] 1. データベーススキーマ更新とマイグレーション
  - profilesテーブルにnicknameカラムを追加（TEXT型）
  - 大文字小文字を区別しないユニーク制約の作成
  - 検索パフォーマンス向上のためのインデックス作成
  - 既存プロフィールにUUIDベースのニックネームを自動設定するマイグレーションスクリプト
  - NOT NULL制約の追加（マイグレーション後）
  - _要件: 6.1, 6.2, 6.3, 7.1_

- [x] 1.1 データベーススキーマ更新のユニットテストを作成
  - マイグレーション処理のテスト
  - ユニーク制約のテスト
  - インデックス作成のテスト
  - _要件: 6.1, 6.2, 6.3_

- [x] 1.2 プロパティ24のプロパティベーステストを実装
  - **プロパティ24: updated_at自動更新**
  - **検証: 要件 6.4**

- [x] 1.3 プロパティ25のプロパティベーステストを実装
  - **プロパティ25: RLSポリシーの継続動作**
  - **検証: 要件 6.5**

- [x] 2. ニックネーム型定義とバリデーション
  - ニックネーム関連の型定義（NicknameValidationResult、NicknameAvailabilityResult等）
  - 予約語リスト（RESERVED_NICKNAMES）の定義
  - Zodスキーマを使用したニックネームバリデーション関数の実装
  - バリデーションエラーメッセージの日本語化
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.6_

- [x] 2.1 ニックネームバリデーションのユニットテストを作成
  - 文字数制限のテスト
  - 文字種制限のテスト
  - 記号位置制限のテスト
  - 連続記号制限のテスト
  - 予約語制限のテスト
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.6_

- [x] 2.2 プロパティ6のプロパティベーステストを実装
  - **プロパティ6: 文字数制限バリデーション**
  - **検証: 要件 2.1**

- [x] 2.3 プロパティ7のプロパティベーステストを実装
  - **プロパティ7: 文字種制限バリデーション**
  - **検証: 要件 2.2**

- [x] 2.4 プロパティ8のプロパティベーステストを実装
  - **プロパティ8: 記号位置制限バリデーション**
  - **検証: 要件 2.3**

- [x] 2.5 プロパティ9のプロパティベーステストを実装
  - **プロパティ9: 連続記号制限バリデーション**
  - **検証: 要件 2.4**

- [x] 2.6 プロパティ11のプロパティベーステストを実装
  - **プロパティ11: 予約語制限**
  - **検証: 要件 2.6**

- [x] 3. ニックネームサービス層の実装
  - nicknameService.tsの作成
  - checkNicknameAvailability関数の実装（大文字小文字無視）
  - findProfileByNickname関数の実装
  - updateNickname関数の実装
  - isReservedNickname関数の実装
  - normalizeNickname関数の実装
  - _要件: 2.5, 3.1, 4.4_

- [x] 3.1 nicknameServiceのユニットテストを作成
  - 利用可能性チェック関数のテスト
  - プロフィール検索関数のテスト
  - ニックネーム更新関数のテスト
  - 予約語チェック関数のテスト
  - _要件: 2.5, 3.1, 4.4_

- [x] 3.2 プロパティ10のプロパティベーステストを実装
  - **プロパティ10: 大文字小文字無視ユニーク性**
  - **検証: 要件 2.5**

- [x] 3.3 プロパティ12のプロパティベーステストを実装
  - **プロパティ12: ニックネームベースURL解決**
  - **検証: 要件 3.1**

- [x] 3.4 プロパティ20のプロパティベーステストを実装
  - **プロパティ20: 有効ニックネーム変更の保存**
  - **検証: 要件 4.4**

- [x] 4. カスタムフックの実装
  - useDebounce.tsの作成（汎用デバウンスフック）
  - useNicknameCheck.tsの作成（利用可能性チェック管理）
  - デバウンス処理（500ms）の実装
  - 状態管理（idle, checking, available, unavailable, error）
  - エラーハンドリングとキャンセル処理
  - _要件: 1.2, 4.2, 5.1_

- [x] 4.1 カスタムフックのユニットテストを作成
  - useDebounceフックのテスト
  - useNicknameCheckフックのテスト
  - 状態遷移のテスト
  - キャンセル処理のテスト
  - _要件: 1.2, 4.2, 5.1_

- [x] 4.2 プロパティ1のプロパティベーステストを実装
  - **プロパティ1: ニックネームリアルタイムチェック**
  - **検証: 要件 1.2, 5.1**

- [x] 4.3 プロパティ18のプロパティベーステストを実装
  - **プロパティ18: ニックネーム変更時のリアルタイムチェック**
  - **検証: 要件 4.2**

- [x] 5. NicknameInputコンポーネントの実装
  - NicknameInputコンポーネントの作成
  - リアルタイムバリデーション機能
  - useNicknameCheckフックとの統合
  - 視覚的フィードバック（チェックマーク、Xマーク、ローディング）
  - ヘルプテキスト表示機能
  - エラーメッセージ表示機能
  - _要件: 1.2, 1.4, 1.5, 5.2, 5.4, 9.4_

- [ ]* 5.1 NicknameInputコンポーネントのユニットテストを作成
  - 入力値の変更テスト
  - バリデーション表示のテスト
  - 利用可能性チェック表示のテスト
  - ヘルプテキスト表示のテスト
  - _要件: 1.2, 1.4, 1.5, 5.2, 5.4, 9.4_

- [ ]* 5.2 プロパティ3のプロパティベーステストを実装
  - **プロパティ3: 無効形式ニックネームの拒否**
  - **検証: 要件 1.4, 5.4**

- [ ]* 5.3 プロパティ4のプロパティベーステストを実装
  - **プロパティ4: 有効ニックネームの受け入れ**
  - **検証: 要件 1.5, 5.2**

- [ ]* 5.4 プロパティ23のプロパティベーステストを実装
  - **プロパティ23: ローディング状態の表示**
  - **検証: 要件 5.5**

- [ ]* 5.5 プロパティ33のプロパティベーステストを実装
  - **プロパティ33: ヘルプテキストの表示**
  - **検証: 要件 9.4**

- [x] 6. NicknameAvailabilityコンポーネントの実装
  - NicknameAvailabilityコンポーネントの作成
  - 状態に応じたアイコン表示（チェック、X、ローディング）
  - 色分けされたメッセージ表示
  - アクセシビリティ対応（aria-live属性）
  - _要件: 5.2, 5.3, 5.4, 5.5_

- [ ]* 6.1 NicknameAvailabilityコンポーネントのユニットテストを作成
  - 各状態でのアイコン表示テスト
  - メッセージ表示のテスト
  - アクセシビリティ属性のテスト
  - _要件: 5.2, 5.3, 5.4, 5.5_

- [ ]* 6.2 プロパティ2のプロパティベーステストを実装
  - **プロパティ2: 使用済みニックネームの拒否**
  - **検証: 要件 1.3, 5.3**

- [x] 7. AuthFormコンポーネントの拡張
  - 既存のAuthFormコンポーネントにニックネーム入力フィールドを追加
  - NicknameInputコンポーネントとの統合
  - 登録時のニックネーム必須チェック
  - フォーム送信時のニックネームバリデーション
  - _要件: 1.1, 1.6_

- [ ]* 7.1 AuthFormコンポーネントの拡張テストを作成
  - ニックネーム入力フィールドの表示テスト
  - フォーム送信時のバリデーションテスト
  - 必須チェックのテスト
  - _要件: 1.1, 1.6_

- [ ]* 7.2 プロパティ5のプロパティベーステストを実装
  - **プロパティ5: ニックネーム保存の永続化**
  - **検証: 要件 1.6**

- [x] 8. ProfileFormコンポーネントの拡張
  - 既存のProfileFormコンポーネントにニックネーム編集機能を追加
  - NicknameInputコンポーネントとの統合
  - 現在のニックネームの初期値設定
  - ニックネーム変更時のバリデーション
  - _要件: 4.1, 4.3_

- [ ]* 8.1 ProfileFormコンポーネントの拡張テストを作成
  - ニックネーム編集フィールドの表示テスト
  - 初期値設定のテスト
  - 変更時のバリデーションテスト
  - _要件: 4.1, 4.3_

- [ ]* 8.2 プロパティ17のプロパティベーステストを実装
  - **プロパティ17: 編集フォームのニックネーム表示**
  - **検証: 要件 4.1**

- [ ]* 8.3 プロパティ19のプロパティベーステストを実装
  - **プロパティ19: 使用済みニックネームへの変更拒否**
  - **検証: 要件 4.3**

- [x] 9. Repository層の拡張
  - 既存のSupabaseProfileRepositoryを拡張
  - save関数でnicknameフィールドの処理を追加
  - findByNickname関数の追加
  - mapToProfile関数でnicknameフィールドのマッピング追加
  - ニックネーム重複チェック機能
  - _要件: 3.1, 4.4_

- [x] 9.1 Repository拡張のユニットテストを作成
  - findByNickname関数のテスト
  - save関数のニックネーム処理テスト
  - 重複チェック機能のテスト
  - _要件: 3.1, 4.4_

- [x] 10. ProfileContextの拡張
  - 既存のProfileContextを拡張
  - createProfile関数でニックネーム処理を追加
  - updateProfile関数でニックネーム変更処理を追加
  - loadProfileByNickname関数の追加
  - ニックネーム変更時のエラーハンドリング
  - _要件: 1.6, 4.4, 4.5_

- [ ]* 10.1 ProfileContext拡張のユニットテストを作成
  - ニックネーム処理のテスト
  - エラーハンドリングのテスト
  - 状態管理のテスト
  - _要件: 1.6, 4.4, 4.5_

- [ ]* 10.2 プロパティ21のプロパティベーステストを実装
  - **プロパティ21: ニックネーム変更後のリダイレクト**
  - **検証: 要件 4.5**

- [x] 11. ルーティングシステムの更新
  - React Routerの設定をニックネームベースに更新
  - ニックネームベースルート（/profile/:nickname）の追加
  - ニックネームベース編集ルート（/profile/:nickname/edit）の追加
  - nicknameProfileLoader関数の実装
  - UUID形式URLの404エラー処理
  - _要件: 3.1, 3.2, 3.5, 3.6_

- [ ]* 11.1 ルーティング更新のユニットテストを作成
  - ニックネームベースルートのテスト
  - プロフィールローダー関数のテスト
  - 404エラー処理のテスト
  - _要件: 3.1, 3.2, 3.5, 3.6_

- [ ]* 11.2 プロパティ13のプロパティベーステストを実装
  - **プロパティ13: 存在しないニックネームの404エラー**
  - **検証: 要件 3.2**

- [ ]* 11.3 プロパティ15のプロパティベーステストを実装
  - **プロパティ15: 編集ページのニックネームベースURL**
  - **検証: 要件 3.5**

- [ ]* 11.4 プロパティ16のプロパティベーステストを実装
  - **プロパティ16: UUID形式URLの404エラー**
  - **検証: 要件 3.6**

- [ ]* 11.5 プロパティ32のプロパティベーステストを実装
  - **プロパティ32: 404ページのメッセージ表示**
  - **検証: 要件 9.3**

- [x] 12. ViewProfileページの更新
  - 既存のViewProfileページをニックネームベースに更新
  - URLパラメータからニックネームを取得する処理
  - ニックネームベースでのプロフィール読み込み
  - 共有URLのニックネームベース化
  - 404エラーハンドリングの改善
  - _要件: 3.1, 3.3, 8.1_

- [ ]* 12.1 ViewProfileページ更新のユニットテストを作成
  - ニックネームベースアクセスのテスト
  - 共有URL生成のテスト
  - エラーハンドリングのテスト
  - _要件: 3.1, 3.3, 8.1_

- [ ]* 12.2 プロパティ14のプロパティベーステストを実装
  - **プロパティ14: 共有URLのニックネームベース化**
  - **検証: 要件 3.3**

- [ ]* 12.3 プロパティ28のプロパティベーステストを実装
  - **プロパティ28: ページタイトルの設定**
  - **検証: 要件 8.1**

- [x] 13. EditProfileページの更新
  - 既存のEditProfileページをニックネームベースに更新
  - ニックネーム変更機能の統合
  - 変更成功時の新しいURLへのリダイレクト
  - 変更失敗時のエラーハンドリング
  - 成功メッセージの表示
  - _要件: 4.1, 4.4, 4.5, 9.5_

- [ ]* 13.1 EditProfileページ更新のユニットテストを作成
  - ニックネーム変更機能のテスト
  - リダイレクト処理のテスト
  - エラーハンドリングのテスト
  - 成功メッセージ表示のテスト
  - _要件: 4.1, 4.4, 4.5, 9.5_

- [ ]* 13.2 プロパティ34のプロパティベーステストを実装
  - **プロパティ34: 成功メッセージの表示**
  - **検証: 要件 9.5**

- [x] 14. マイグレーションサービスの実装
  - migrationService.tsの作成
  - migrateAllProfiles関数の実装
  - migrateProfile関数の実装
  - checkMigrationStatus関数の実装
  - マイグレーション実行スクリプト
  - _要件: 7.1, 7.3_

- [ ]* 14.1 マイグレーションサービスのユニットテストを作成
  - マイグレーション関数のテスト
  - 状態チェック関数のテスト
  - エラーハンドリングのテスト
  - _要件: 7.1, 7.3_

- [x] 15. 既存ユーザー向け通知機能
  - UUID形式ニックネームを持つユーザーへの通知表示
  - 通知コンポーネントの作成
  - カスタマイズ促進メッセージの実装
  - 通知の表示/非表示制御
  - _要件: 7.2, 7.4_

- [ ]* 15.1 通知機能のユニットテストを作成
  - 通知表示条件のテスト
  - メッセージ内容のテスト
  - 表示制御のテスト
  - _要件: 7.2, 7.4_

- [ ]* 15.2 プロパティ26のプロパティベーステストを実装
  - **プロパティ26: 既存ユーザーのニックネーム表示**
  - **検証: 要件 7.2**

- [ ]* 15.3 プロパティ27のプロパティベーステストを実装
  - **プロパティ27: UUID形式ニックネームの通知**
  - **検証: 要件 7.4**

- [x] 16. SEOとメタデータ機能の実装
  - 動的ページタイトル設定機能
  - メタディスクリプション生成機能
  - Open Graphメタタグ設定機能
  - 構造化データ（JSON-LD）生成機能
  - SEOコンポーネントの作成
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [ ]* 16.1 SEO機能のユニットテストを作成
  - ページタイトル生成のテスト
  - メタディスクリプション生成のテスト
  - Open Graphタグ生成のテスト
  - 構造化データ生成のテスト
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [ ]* 16.2 プロパティ29のプロパティベーステストを実装
  - **プロパティ29: メタディスクリプションの設定**
  - **検証: 要件 8.2**

- [ ]* 16.3 プロパティ30のプロパティベーステストを実装
  - **プロパティ30: Open Graphメタタグの設定**
  - **検証: 要件 8.3**

- [ ]* 16.4 プロパティ31のプロパティベーステストを実装
  - **プロパティ31: 構造化データの提供**
  - **検証: 要件 8.4**

- [x] 17. エラーハンドリングの強化
  - ニックネーム関連エラーの統一的処理
  - ネットワークエラーハンドリング
  - データベースエラーハンドリング
  - ユーザーフレンドリーなエラーメッセージ
  - エラー回復機能（リトライ等）
  - _要件: 9.1, 9.2, 9.3_

- [ ]* 17.1 エラーハンドリングのユニットテストを作成
  - 各種エラーケースのテスト
  - エラーメッセージ表示のテスト
  - 回復機能のテスト
  - _要件: 9.1, 9.2, 9.3_

- [x] 18. パフォーマンス最適化
  - ニックネーム利用可能性チェックの最適化
  - データベースクエリの最適化
  - キャッシュ機能の実装
  - レート制限の実装
  - _要件: 10.1, 10.2, 10.4, 10.5_

- [ ]* 18.1 パフォーマンス機能のユニットテストを作成
  - キャッシュ機能のテスト
  - レート制限のテスト
  - 最適化機能のテスト
  - _要件: 10.1, 10.2, 10.4, 10.5_

- [ ]* 18.2 プロパティ35のプロパティベーステストを実装
  - **プロパティ35: キャッシュ無効化**
  - **検証: 要件 10.5**

- [ ] 19. セキュリティ強化
  - SQLインジェクション対策の確認
  - パラメータ化クエリの実装
  - 入力サニタイゼーション
  - レート制限によるDDoS対策
  - _要件: 10.3, 10.4_

- [ ]* 19.1 セキュリティ機能のユニットテストを作成
  - SQLインジェクション対策のテスト
  - 入力サニタイゼーションのテスト
  - レート制限のテスト
  - _要件: 10.3, 10.4_

- [ ] 20. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [ ] 21. 統合テストの作成
  - アカウント登録からニックネーム設定までのフロー
  - ニックネーム変更フローの統合テスト
  - ニックネームベースURL解決の統合テスト
  - エラーハンドリングの統合テスト
  - マイグレーション処理の統合テスト
  - SEO機能の統合テスト

- [ ] 22. 最終調整とリファクタリング
  - コードレビューと最適化
  - 不要なコードの削除
  - コメントとドキュメントの追加
  - パフォーマンスの確認
  - セキュリティの最終確認
  - _要件: すべて_

- [ ] 23. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する