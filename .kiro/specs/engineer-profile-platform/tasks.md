# 実装計画

- [x] 1. Supabaseプロジェクトのセットアップ
  - Supabaseプロジェクトの作成（https://supabase.com）
  - プロジェクトURLとAPIキーの取得
  - 環境変数の設定（.env.local）
  - @supabase/supabase-jsのインストール
  - Supabaseクライアントの初期化（src/lib/supabase.ts）
  - _要件: すべての要件の基盤_

- [x] 2. データベーススキーマの作成
  - profilesテーブルの作成（SQL実行）
  - Row Level Security (RLS)の有効化
  - RLSポリシーの作成（SELECT, INSERT, UPDATE, DELETE）
  - updated_at自動更新トリガーの作成
  - _要件: 7.1, 11.5_

- [x] 3. 型定義とバリデーションスキーマの更新
  - User型の定義（Supabase Auth用）
  - Profile型の更新（user_idフィールドを追加）
  - 認証用のZodスキーマの実装（signUpSchema, signInSchema）
  - プロフィール用のZodスキーマの更新
  - _要件: 1.3, 1.4, 4.5, 4.7_

- [x] 3.1 バリデーション関数のユニットテストを作成
  - メールアドレスバリデーションのテスト
  - パスワードバリデーションのテスト
  - URLバリデーションのテスト
  - 数値バリデーションのテスト
  - _要件: 1.3, 1.4, 4.5, 4.7_

- [x] 3.2 プロパティ2のプロパティベーステストを実装
  - **プロパティ2: 無効なメールアドレスの拒否**
  - **検証: 要件 1.3**

- [x] 3.3 プロパティ3のプロパティベーステストを実装
  - **プロパティ3: 短いパスワードの拒否**
  - **検証: 要件 1.4**

- [x] 3.4 プロパティ16のプロパティベーステストを実装
  - **プロパティ16: URLバリデーション**
  - **検証: 要件 4.5**

- [x] 3.5 プロパティ18のプロパティベーステストを実装
  - **プロパティ18: 経験年数の数値バリデーション**
  - **検証: 要件 4.7**

- [x] 4. 認証サービスの実装
  - authService.tsの作成
  - signUp関数の実装
  - signIn関数の実装
  - signOut関数の実装
  - getSession関数の実装
  - getCurrentUser関数の実装
  - _要件: 1.2, 2.2, 2.5_

- [x] 4.1 authServiceのユニットテストを作成
  - モックSupabaseクライアントを使用したテスト
  - 各関数のテスト
  - エラーハンドリングのテスト
  - _要件: 1.2, 2.2, 2.5_

- [x] 4.2 プロパティ1のプロパティベーステストを実装
  - **プロパティ1: 有効な認証情報でのアカウント作成**
  - **検証: 要件 1.2**

- [x] 4.3 プロパティ5のプロパティベーステストを実装
  - **プロパティ5: 正しい認証情報でのログイン**
  - **検証: 要件 2.2**

- [x] 4.4 プロパティ6のプロパティベーステストを実装
  - **プロパティ6: 間違った認証情報の拒否**
  - **検証: 要件 2.3**

- [x] 5. AuthContextの実装
  - AuthContextとAuthProviderの作成
  - useReducerを使用した状態管理
  - signUp, signIn, signOutアクションの実装
  - セッション監視の実装（onAuthStateChange）
  - ローディング状態とエラー状態の管理
  - _要件: 1.2, 2.2, 2.5, 2.6_

- [x] 5.1 AuthContextのユニットテストを作成
  - モックauthServiceを使用したテスト
  - 各アクションのテスト
  - セッション監視のテスト
  - _要件: 1.2, 2.2, 2.5, 2.6_

- [x] 5.2 プロパティ9のプロパティベーステストを実装
  - **プロパティ9: セッションの永続性**
  - **検証: 要件 2.6**

- [x] 6. Repository層の実装
  - ProfileRepositoryインターフェースの定義
  - SupabaseProfileRepositoryの実装（save, findById, findByUserId, findAll, delete, exists）
  - データマッピング関数の実装（Supabase ↔ アプリケーション型）
  - エラーハンドリングの実装
  - _要件: 7.1, 7.2_

- [x] 6.1 SupabaseProfileRepositoryのユニットテストを作成
  - モックSupabaseクライアントを使用したテスト
  - 各メソッドのテスト
  - エラーケースのテスト
  - _要件: 7.1, 7.2_

- [x] 6.2 プロパティ27のプロパティベーステストを実装
  - **プロパティ27: データベースラウンドトリップ**
  - **検証: 要件 7.1, 7.2**

- [x] 7. ProfileContextの実装
  - ProfileContextとProfileProviderの作成
  - useReducerを使用した状態管理
  - Repository依存性注入の実装
  - createProfile, updateProfile, deleteProfile, loadProfile, loadMyProfileアクションの実装
  - ローディング状態とエラー状態の管理
  - _要件: 3.3, 5.4, 10.2_

- [x] 7.1 ProfileContextのユニットテストを作成
  - モックRepositoryを使用したテスト
  - 各アクションのテスト
  - エラーハンドリングのテスト
  - _要件: 3.3, 5.4, 10.2_

- [x] 8. 共通UIコンポーネントの実装
  - Buttonコンポーネント
  - Inputコンポーネント
  - TextAreaコンポーネント
  - LoadingSpinnerコンポーネント
  - ErrorMessageコンポーネント
  - _要件: 9.2, 9.4_

- [x] 9. AuthFormコンポーネントの実装
  - フォームレイアウトの作成
  - メールアドレスとパスワードの入力フィールド
  - モード切り替え（登録/ログイン）
  - リアルタイムバリデーションの実装
  - エラーメッセージ表示の実装
  - _要件: 1.1, 2.1_

- [x] 9.1 AuthFormコンポーネントのユニットテストを作成
  - フォーム送信のテスト
  - バリデーションエラー表示のテスト
  - モード切り替えのテスト
  - _要件: 1.1, 2.1_

- [x] 10. アカウント登録ページの実装
  - SignUpページコンポーネントの作成
  - AuthFormの統合（signupモード）
  - アカウント登録処理の実装
  - 登録成功時の自動ログインとリダイレクト処理
  - _要件: 1.1, 1.2, 1.5_

- [x] 10.1 プロパティ4のプロパティベーステストを実装
  - **プロパティ4: アカウント作成後の自動ログインとリダイレクト**
  - **検証: 要件 1.5**

- [x] 11. ログインページの実装
  - SignInページコンポーネントの作成
  - AuthFormの統合（signinモード）
  - ログイン処理の実装
  - ログイン成功時のリダイレクト処理
  - _要件: 2.1, 2.2, 2.4_

- [x] 11.1 プロパティ7のプロパティベーステストを実装
  - **プロパティ7: ログイン成功後のリダイレクト**
  - **検証: 要件 2.4**

- [x] 12. ProtectedRouteコンポーネントの実装
  - 認証状態のチェック
  - 未認証ユーザーのリダイレクト処理
  - ローディング状態の表示
  - _要件: 3.1, 5.2_

- [x] 12.1 プロパティ10のプロパティベーステストを実装
  - **プロパティ10: 未認証ユーザーの保護されたページへのアクセス拒否**
  - **検証: 要件 3.1**

- [x] 13. ProfileFormコンポーネントの実装
  - フォームレイアウトの作成
  - 基本フィールド（名前、職種、自己紹介、経験年数）の実装
  - スキルタグ入力の実装
  - SNSリンク動的追加・削除機能の実装
  - サービス選択UI（定義済み/カスタム）の実装
  - リアルタイムバリデーションの実装
  - エラーメッセージ表示の実装
  - _要件: 3.2, 4.1, 4.2, 4.3, 4.4, 4.6, 4.8, 9.2_

- [x] 13.1 ProfileFormコンポーネントのユニットテストを作成
  - フォーム送信のテスト
  - バリデーションエラー表示のテスト
  - スキル追加・削除のテスト
  - SNSリンク追加・削除のテスト
  - _要件: 3.2, 4.1, 4.6, 4.8_

- [x] 13.2 プロパティ14のプロパティベーステストを実装
  - **プロパティ14: 無効な必須項目の拒否**
  - **検証: 要件 3.5**

- [x] 13.3 プロパティ17のプロパティベーステストを実装
  - **プロパティ17: スキル配列の管理**
  - **検証: 要件 4.6**

- [x] 14. プロフィール作成ページの実装
  - CreateProfileページコンポーネントの作成
  - ProtectedRouteでラップ
  - ProfileFormの統合
  - プロフィール作成処理の実装（user_idの紐付け）
  - 作成成功時のリダイレクト処理
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.6_

- [x] 14.1 プロパティ11のプロパティベーステストを実装
  - **プロパティ11: 認証済みユーザーのプロフィール作成ページへのアクセス**
  - **検証: 要件 3.2**

- [x] 14.2 プロパティ12のプロパティベーステストを実装
  - **プロパティ12: 有効なプロフィールデータの保存**
  - **検証: 要件 3.3**

- [x] 14.3 プロパティ13のプロパティベーステストを実装
  - **プロパティ13: プロフィールと所有者の紐付け**
  - **検証: 要件 3.4, 11.1**

- [x] 14.4 プロパティ15のプロパティベーステストを実装
  - **プロパティ15: プロフィール作成後のリダイレクト**
  - **検証: 要件 3.6**

- [x] 15. ProfileCardコンポーネントの実装
  - 名刺風レイアウトの作成
  - プロフィール情報の表示
  - SNSリンクの表示（アイコン付き）
  - 所有者判定による編集・削除ボタンの表示制御
  - 共有ボタンの実装
  - レスポンシブデザインの実装
  - _要件: 6.2, 11.2, 11.3, 11.4_

- [x] 15.1 ProfileCardコンポーネントのユニットテストを作成
  - プロフィール情報表示のテスト
  - SNSリンク表示のテスト
  - ボタン表示制御のテスト（所有者判定）
  - _要件: 6.2, 11.2, 11.3, 11.4_

- [x] 15.2 プロパティ26のプロパティベーステストを実装
  - **プロパティ26: プロフィール情報の完全表示**
  - **検証: 要件 6.2**

- [x] 15.3 プロパティ35のプロパティベーステストを実装
  - **プロパティ35: 未認証ユーザーへの編集・削除ボタン非表示**
  - **検証: 要件 11.2**

- [x] 15.4 プロパティ36のプロパティベーステストを実装
  - **プロパティ36: 他人のプロフィールへの編集・削除ボタン非表示**
  - **検証: 要件 11.3**

- [x] 15.5 プロパティ37のプロパティベーステストを実装
  - **プロパティ37: 自分のプロフィールへの編集・削除ボタン表示**
  - **検証: 要件 11.4**

- [x] 16. プロフィール表示ページの実装
  - ViewProfileページコンポーネントの作成
  - URLパラメータからプロフィールIDを取得
  - プロフィールデータの読み込み
  - ProfileCardの統合
  - 所有者判定ロジックの実装
  - 404エラーハンドリング（プロフィールが存在しない場合）
  - _要件: 6.1, 11.2, 11.3, 11.4_

- [x] 16.1 プロパティ25のプロパティベーステストを実装
  - **プロパティ25: プロフィールURLアクセス**
  - **検証: 要件 6.1**

- [x] 17. プロフィール編集ページの実装
  - EditProfileページコンポーネントの作成
  - ProtectedRouteでラップ
  - 所有者チェックの実装
  - 既存プロフィールデータの読み込み
  - ProfileFormへの初期値設定
  - 更新処理の実装
  - キャンセル処理の実装
  - 更新成功時のリダイレクト処理
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [x] 17.1 プロパティ19のプロパティベーステストを実装
  - **プロパティ19: 編集フォームへのデータ読み込み**
  - **検証: 要件 5.1**

- [x] 17.2 プロパティ20のプロパティベーステストを実装
  - **プロパティ20: 未認証ユーザーの編集ページへのアクセス拒否**
  - **検証: 要件 5.2**

- [x] 17.3 プロパティ21のプロパティベーステストを実装
  - **プロパティ21: 他人のプロフィール編集の拒否**
  - **検証: 要件 5.3**

- [x] 17.4 プロパティ22のプロパティベーステストを実装
  - **プロパティ22: プロフィール更新の永続化**
  - **検証: 要件 5.4**

- [x] 17.5 プロパティ23のプロパティベーステストを実装
  - **プロパティ23: 更新後のデータ表示**
  - **検証: 要件 5.5**

- [x] 17.6 プロパティ24のプロパティベーステストを実装
  - **プロパティ24: 編集キャンセルの不変性**
  - **検証: 要件 5.6**

- [x] 18. プロフィール削除機能の実装
  - 削除確認ダイアログコンポーネントの作成
  - 削除処理の実装
  - 削除成功時のリダイレクト処理
  - キャンセル処理の実装
  - _要件: 10.1, 10.2, 10.3, 10.4_

- [x] 18.1 プロパティ31のプロパティベーステストを実装
  - **プロパティ31: プロフィール削除確認ダイアログの表示**
  - **検証: 要件 10.1**

- [x] 18.2 プロパティ32のプロパティベーステストを実装
  - **プロパティ32: プロフィール削除の永続化**
  - **検証: 要件 10.2**

- [x] 18.3 プロパティ33のプロパティベーステストを実装
  - **プロパティ33: 削除後のリダイレクト**
  - **検証: 要件 10.3**

- [x] 18.4 プロパティ34のプロパティベーステストを実装
  - **プロパティ34: 削除キャンセルの不変性**
  - **検証: 要件 10.4**

- [x] 19. URL共有機能の実装
  - 共有URL生成ロジックの実装
  - クリップボードAPIの統合
  - コピー成功通知の実装
  - _要件: 8.1, 8.4_

- [x] 19.1 プロパティ28のプロパティベーステストを実装
  - **プロパティ28: クリップボードへのURLコピー**
  - **検証: 要件 8.4**

- [x] 20. ナビゲーションとルーティングの実装
  - Navigationコンポーネントの作成
  - ログイン状態に応じた表示切り替え（ログイン/ログアウトボタン）
  - React Routerの設定
  - ルート定義（/, /signup, /signin, /create, /profile/:id, /profile/:id/edit）
  - 404ページの実装
  - _要件: 9.3_

- [x] 20.1 プロパティ8のプロパティベーステストを実装
  - **プロパティ8: ログアウト後のセッション終了**
  - **検証: 要件 2.5**

- [x] 21. ホームページの実装
  - ホームページコンポーネントの作成
  - ログイン状態に応じた表示切り替え
  - ログイン済み：プロフィール作成へのリンク
  - 未ログイン：登録/ログインへのリンク
  - 簡単な説明文の表示
  - _要件: 1.1, 2.1_

- [x] 22. ローディング状態とエラーハンドリングの実装
  - ローディングインジケーターの統合
  - エラーメッセージ表示の統合
  - グローバルエラーバウンダリの実装
  - 認証エラーのハンドリング
  - データベースエラーのハンドリング
  - _要件: 9.2, 9.4_

- [x] 22.1 プロパティ29のプロパティベーステストを実装
  - **プロパティ29: バリデーションエラーメッセージ表示**
  - **検証: 要件 9.2**

- [x] 22.2 プロパティ30のプロパティベーステストを実装
  - **プロパティ30: ローディング状態の表示**
  - **検証: 要件 9.4**

- [x] 23. スタイリングとレスポンシブデザインの実装
  - CSS ModulesまたはTailwind CSSのセットアップ
  - 各コンポーネントのスタイリング
  - レスポンシブデザインの実装（モバイル・タブレット・デスクトップ）
  - 名刺風デザインの洗練
  - 定義済みサービスのアイコン追加
  - _要件: 9.1_

- [x] 24. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [x] 25. 統合テストの作成
  - アカウント登録からプロフィール作成までのフロー
  - ログインからプロフィール編集までのフロー
  - プロフィール削除フローの統合テスト
  - 認証ガードのテスト（未認証ユーザーのアクセス制御）
  - 所有者制御のテスト（他人のプロフィール編集の拒否）
  - Row Level Security (RLS)のテスト
  - ルーティングとナビゲーションのテスト

- [x] 26. 最終調整とリファクタリング
  - コードレビューと最適化
  - 不要なコードの削除
  - コメントとドキュメントの追加
  - パフォーマンスの確認
  - Supabase設定の最終確認
  - _要件: すべて_

- [x] 27. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

## 画像アップロード機能とSNSリンク改修

- [x] 28. Supabase Storageの設定
  - Supabaseダッシュボードで`profile-images`バケットを作成
  - バケットを公開設定にする
  - RLSポリシーの作成（SELECT、INSERT、UPDATE、DELETE）
  - ストレージポリシーのテスト
  - _要件: 12.5_

- [ ] 29. 型定義の更新
  - PredefinedServiceにLINKEDINを追加
  - Profile型にimageUrl?フィールドを追加
  - ProfileFormData型にimageFile?とimageUrl?フィールドを追加
  - _要件: 4.1, 4.9, 12.12_

- [ ] 30. データベーススキーマの更新
  - profilesテーブルにimage_urlカラムを追加（ALTER TABLE）
  - マイグレーションSQLの実行
  - _要件: 4.12_

- [ ] 31. ImageServiceの実装
- [ ] 31.1 画像バリデーション関数の実装
  - validateImageFile関数の実装（ファイルタイプとサイズのチェック）
  - _要件: 12.3, 12.4, 4.9_

- [ ] 31.2 プロパティ38のプロパティベーステストを実装
  - **プロパティ38: 大きすぎる画像ファイルの拒否**
  - **検証: 要件 12.3**

- [ ] 31.3 プロパティ39のプロパティベーステストを実装
  - **プロパティ39: 無効なファイルタイプの拒否**
  - **検証: 要件 12.4**

- [ ] 31.4 プロパティ40のプロパティベーステストを実装
  - **プロパティ40: 有効な画像形式の受け入れ**
  - **検証: 要件 4.9**

- [ ] 31.5 画像アップロード関数の実装
  - uploadProfileImage関数の実装
  - 一意のファイル名生成（userId + timestamp）
  - Supabase Storageへのアップロード
  - 公開URLの取得
  - _要件: 12.5, 12.6_

- [ ] 31.6 プロパティ41のプロパティベーステストを実装
  - **プロパティ41: 画像のStorageアップロード**
  - **検証: 要件 12.5**

- [ ] 31.7 プロパティ42のプロパティベーステストを実装
  - **プロパティ42: 一意のファイル名生成**
  - **検証: 要件 12.6**

- [ ] 31.8 画像削除関数の実装
  - deleteProfileImage関数の実装
  - URLからパスを抽出
  - Supabase Storageから削除
  - _要件: 12.7, 12.8, 12.10_

- [ ] 31.9 公開URL取得関数の実装
  - getPublicUrl関数の実装
  - _要件: 4.12_

- [ ] 31.10 ImageServiceのユニットテストを作成
  - バリデーション関数のテスト
  - アップロード関数のテスト（モックStorage使用）
  - 削除関数のテスト（モックStorage使用）
  - _要件: 12.3, 12.4, 12.5, 12.6, 12.7, 12.8, 12.10_

- [ ] 32. SupabaseProfileRepositoryの更新
  - save関数でimage_urlフィールドを処理
  - mapToProfile関数でimageUrlをマッピング
  - _要件: 4.12_

- [ ] 32.1 プロパティ43のプロパティベーステストを実装
  - **プロパティ43: 画像URLのプロフィールへの記録**
  - **検証: 要件 4.12**

- [ ] 33. ProfileContextの更新
- [ ] 33.1 createProfile関数の更新
  - 画像ファイルがある場合、ImageServiceでアップロード
  - アップロード成功後、image_urlをプロフィールに設定
  - エラーハンドリング（画像アップロード失敗時も保存継続）
  - _要件: 12.5, 12.9_

- [ ] 33.2 updateProfile関数の更新
  - 新しい画像ファイルがある場合、古い画像を削除してから新しい画像をアップロード
  - 画像削除フラグがある場合、画像を削除してimage_urlをnullに設定
  - _要件: 12.7, 12.10_

- [ ] 33.3 プロパティ44のプロパティベーステストを実装
  - **プロパティ44: 既存画像の削除（更新時）**
  - **検証: 要件 12.7**

- [ ] 33.4 deleteProfile関数の更新
  - プロフィール削除時に画像も削除
  - _要件: 12.8_

- [ ] 33.5 プロパティ45のプロパティベーステストを実装
  - **プロパティ45: 画像の削除（プロフィール削除時）**
  - **検証: 要件 12.8**

- [ ] 33.6 プロパティ46のプロパティベーステストを実装
  - **プロパティ46: 画像の削除（ユーザー操作）**
  - **検証: 要件 12.10**

- [ ] 34. ProfileFormコンポーネントの更新
- [ ] 34.1 画像アップロードUIの追加
  - ファイル入力フィールドの追加
  - 画像プレビュー表示の実装
  - 画像削除ボタンの追加
  - ドラッグ&ドロップ対応（オプション）
  - _要件: 12.1, 12.2, 12.10_

- [ ] 34.2 画像バリデーションの統合
  - ファイル選択時のバリデーション
  - エラーメッセージ表示
  - _要件: 12.3, 12.4_

- [ ] 34.3 フォーム送信処理の更新
  - imageFileをProfileFormDataに含める
  - 既存画像の処理
  - _要件: 12.5_

- [ ] 34.4 ProfileFormコンポーネントのユニットテストを更新
  - 画像アップロードのテスト
  - 画像プレビューのテスト
  - 画像削除のテスト
  - バリデーションエラー表示のテスト
  - _要件: 12.1, 12.2, 12.3, 12.4, 12.10_

- [ ] 35. ProfileCardコンポーネントの更新
- [ ] 35.1 プロフィール画像表示の追加
  - imageUrlがある場合は画像を表示
  - imageUrlがない場合はデフォルトアバターを表示
  - 画像の配置とスタイリング（名刺の上部）
  - _要件: 6.3, 6.4_

- [ ] 35.2 SNSリンクアイコンの更新
  - react-iconsのインストール（npm install react-icons）
  - 定義済みサービスに公式アイコンを表示
    - Twitter: FaXTwitter
    - GitHub: FaGithub
    - Facebook: FaFacebook
    - LinkedIn: FaLinkedin
  - カスタムサービスはテキスト表示
  - _要件: 4.3, 6.5, 6.6_

- [ ] 35.3 プロパティ47のプロパティベーステストを実装
  - **プロパティ47: 定義済みサービスの公式アイコン表示**
  - **検証: 要件 6.5**

- [ ] 35.4 プロパティ48のプロパティベーステストを実装
  - **プロパティ48: カスタムサービスのサービス名表示**
  - **検証: 要件 6.6**

- [ ] 35.5 ProfileCardコンポーネントのユニットテストを更新
  - プロフィール画像表示のテスト
  - デフォルトアバター表示のテスト
  - SNSアイコン表示のテスト（定義済みサービス）
  - SNSテキスト表示のテスト（カスタムサービス）
  - _要件: 6.3, 6.4, 6.5, 6.6_

- [ ] 36. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [ ] 37. 統合テストの作成
  - 画像アップロードからプロフィール作成までのフロー
  - 画像更新（既存画像の削除）のフロー
  - プロフィール削除時の画像削除のフロー
  - Supabase Storage RLSのテスト
  - _要件: 12.5, 12.7, 12.8_

- [ ] 38. 最終調整とリファクタリング
  - コードレビューと最適化
  - 画像表示のレスポンシブ対応
  - アクセシビリティの確認（alt属性など）
  - パフォーマンスの確認（画像の遅延読み込みなど）
  - _要件: すべて_

- [ ] 39. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する
