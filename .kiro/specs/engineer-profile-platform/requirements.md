# 要件定義書

## はじめに

Linkerは、エンジニアが自己紹介を行い、他のエンジニアとつながるためのプラットフォームです。エンジニアは自身のプロフィール情報を登録し、スキル、経験、プロジェクトなどを共有できます。他のユーザーはこれらのプロフィールを閲覧し、興味のあるエンジニアを発見できます。

システムはSupabaseを使用して、認証とデータ管理を行います。ユーザーはメールアドレスとパスワードでアカウントを作成し、自分のプロフィールのみを編集・削除できます。

## 用語集

- **Linker**: エンジニアプロフィールプラットフォームシステム
- **User**: システムを利用するエンジニア
- **Account**: ユーザーのアカウント（メールアドレスとパスワードで管理）
- **Profile**: ユーザーの自己紹介情報（スキル、経験、プロジェクトなど）
- **Profile Form**: プロフィール情報を入力・編集するためのフォーム
- **Profile Page**: 個別のプロフィールを表示するページ
- **Profile URL**: プロフィールを共有するための一意のURL
- **Supabase**: バックエンドサービス（認証、データベース、ストレージを提供）
- **Supabase Auth**: Supabaseの認証サービス
- **Supabase Storage**: Supabaseのファイルストレージサービス
- **Row Level Security (RLS)**: データベースレベルのアクセス制御機能
- **Session**: ログイン状態を管理するセッション情報
- **Profile Image**: ユーザーのプロフィール画像（アバター）
- **Social Icon**: SNSサービスの公式アイコン

## 要件

### 要件 1: アカウント登録

**ユーザーストーリー:** エンジニアとして、アカウントを作成したいので、プロフィールを作成して管理できるようにしたい。

#### 受け入れ基準

1. WHEN ユーザーが登録ページにアクセスする THEN Linker SHALL メールアドレスとパスワードの入力フォームを表示する
2. WHEN ユーザーが有効なメールアドレスとパスワードを入力して登録する THEN Linker SHALL Supabase Authを使用して新しいアカウントを作成する
3. WHEN ユーザーが無効なメールアドレスを入力する THEN Linker SHALL エラーメッセージを表示してアカウント作成を防止する
4. WHEN ユーザーが短すぎるパスワード（6文字未満）を入力する THEN Linker SHALL エラーメッセージを表示してアカウント作成を防止する
5. WHEN アカウントが正常に作成される THEN Linker SHALL ユーザーを自動的にログインさせてプロフィール作成ページにリダイレクトする
6. WHEN 既に登録済みのメールアドレスで登録しようとする THEN Linker SHALL エラーメッセージを表示する

### 要件 2: ログイン・ログアウト

**ユーザーストーリー:** エンジニアとして、アカウントにログインしたいので、自分のプロフィールを管理できるようにしたい。

#### 受け入れ基準

1. WHEN ユーザーがログインページにアクセスする THEN Linker SHALL メールアドレスとパスワードの入力フォームを表示する
2. WHEN ユーザーが正しいメールアドレスとパスワードを入力する THEN Linker SHALL Supabase Authを使用してログインさせる
3. WHEN ユーザーが間違ったメールアドレスまたはパスワードを入力する THEN Linker SHALL エラーメッセージを表示する
4. WHEN ログインが成功する THEN Linker SHALL ユーザーをホームページまたはプロフィール作成ページにリダイレクトする
5. WHEN ログイン済みのユーザーがログアウトボタンをクリックする THEN Linker SHALL セッションを終了してログインページにリダイレクトする
6. WHEN ユーザーがページをリロードする THEN Linker SHALL セッション情報を保持してログイン状態を維持する

### 要件 3: プロフィール作成

**ユーザーストーリー:** エンジニアとして、自分のプロフィールを作成したいので、他のエンジニアに自己紹介できるようにしたい。

#### 受け入れ基準

1. WHEN ログインしていないユーザーがプロフィール作成ページにアクセスする THEN Linker SHALL ログインページにリダイレクトする
2. WHEN ログイン済みユーザーがプロフィール作成ページにアクセスする THEN Linker SHALL プロフィール入力フォームを表示する
3. WHEN ユーザーが必須項目（名前、職種）を入力してフォームを送信する THEN Linker SHALL 新しいプロフィールをSupabaseデータベースに保存する
4. WHEN プロフィールが保存される THEN Linker SHALL ログイン中のユーザーIDをプロフィールに紐付ける
5. WHEN ユーザーが必須項目を入力せずにフォームを送信する THEN Linker SHALL エラーメッセージを表示してプロフィール作成を防止する
6. WHEN プロフィールが正常に作成される THEN Linker SHALL ユーザーをプロフィール詳細ページにリダイレクトする

### 要件 4: プロフィール情報管理

**ユーザーストーリー:** エンジニアとして、詳細なプロフィール情報を登録したいので、自分のスキルや経験を効果的に伝えたい。

#### 受け入れ基準

1. WHEN ユーザーがプロフィールフォームに入力する THEN Linker SHALL 以下の情報を受け付ける：名前、職種、自己紹介文、スキル、経験年数、プロフィール画像、SNS・外部リンク（サービス名とURL）
2. WHEN ユーザーがSNSリンクを追加する THEN Linker SHALL 定義済みサービス（Twitter、GitHub、Facebook、LinkedIn）またはカスタムサービス名を選択できるようにする
3. WHEN ユーザーが定義済みサービスを選択する THEN Linker SHALL 適切なサービス名と公式アイコンを表示する
4. WHEN ユーザーがカスタムサービスを選択する THEN Linker SHALL 自由にサービス名を入力できるようにする
5. WHEN ユーザーがSNSリンクのURLを入力する THEN Linker SHALL 有効なURL形式であることを検証する
6. WHEN ユーザーがスキルを入力する THEN Linker SHALL 複数のスキルをタグ形式で管理できるようにする
7. WHEN ユーザーが経験年数を入力する THEN Linker SHALL 0以上の数値のみを受け付ける
8. WHEN ユーザーがSNSリンクを削除する THEN Linker SHALL 指定されたリンクをリストから削除する
9. WHEN ユーザーがプロフィール画像をアップロードする THEN Linker SHALL 画像ファイル（JPEG、PNG、WebP）を受け付ける
10. WHEN ユーザーが画像をアップロードする THEN Linker SHALL ファイルサイズが5MB以下であることを検証する
11. WHEN 画像がアップロードされる THEN Linker SHALL Supabase Storageに画像を保存する
12. WHEN プロフィール画像が保存される THEN Linker SHALL 画像URLをプロフィールデータに記録する

### 要件 5: プロフィール編集

**ユーザーストーリー:** エンジニアとして、既存のプロフィールを編集したいので、情報を最新の状態に保てるようにしたい。

#### 受け入れ基準

1. WHEN ログイン済みユーザーが自分のプロフィールページで編集ボタンをクリックする THEN Linker SHALL 現在の情報が入力された編集フォームを表示する
2. WHEN ログインしていないユーザーが編集URLに直接アクセスする THEN Linker SHALL ログインページにリダイレクトする
3. WHEN ログイン済みユーザーが他人のプロフィールの編集URLに直接アクセスする THEN Linker SHALL アクセスを拒否してプロフィール表示ページにリダイレクトする
4. WHEN ユーザーがプロフィール情報を変更して保存する THEN Linker SHALL 更新された情報をSupabaseデータベースに保存する
5. WHEN プロフィールが正常に更新される THEN Linker SHALL 更新されたプロフィール詳細ページを表示する
6. WHEN ユーザーが編集をキャンセルする THEN Linker SHALL 変更を破棄して元のプロフィールページに戻る

### 要件 6: プロフィール閲覧

**ユーザーストーリー:** エンジニアとして、他のエンジニアのプロフィールを閲覧したいので、興味のある人を見つけられるようにしたい。

#### 受け入れ基準

1. WHEN ユーザーが共有されたプロフィールURLにアクセスする THEN Linker SHALL そのプロフィールの詳細ページを表示する
2. WHEN プロフィール詳細ページが表示される THEN Linker SHALL すべてのプロフィール情報（プロフィール画像、名前、職種、自己紹介、スキル、経験年数、SNSリンク）を表示する
3. WHEN プロフィール画像が設定されている THEN Linker SHALL 画像を名刺の上部に表示する
4. WHEN プロフィール画像が設定されていない THEN Linker SHALL デフォルトのアバター画像を表示する
5. WHEN SNSリンクが表示される THEN Linker SHALL 定義済みサービスの場合は公式アイコンとともにクリック可能なリンクとして表示する
6. WHEN カスタムサービスのSNSリンクが表示される THEN Linker SHALL サービス名とともにクリック可能なリンクとして表示する
7. WHEN プロフィールが名刺のように表示される THEN Linker SHALL 見やすく整理されたレイアウトで情報を提示する

### 要件 7: データ永続化

**ユーザーストーリー:** エンジニアとして、登録したプロフィール情報が保存されることを期待するので、どのデバイスからアクセスしても情報が失われないようにしたい。

#### 受け入れ基準

1. WHEN プロフィールが作成または更新される THEN Linker SHALL データをSupabaseデータベースに即座に保存する
2. WHEN ユーザーがページをリロードする THEN Linker SHALL Supabaseデータベースからプロフィールデータを読み込んで表示する
3. WHEN データベースからデータを読み込む際にエラーが発生する THEN Linker SHALL エラーを適切に処理してエラーメッセージを表示する
4. WHEN ユーザーが別のデバイスからログインする THEN Linker SHALL 同じプロフィールデータにアクセスできる

### 要件 8: プロフィール共有

**ユーザーストーリー:** エンジニアとして、自分のプロフィールを他の人に共有したいので、名刺のように特定の個人に渡せるようにしたい。

#### 受け入れ基準

1. WHEN ユーザーが自分のプロフィールページを表示する THEN Linker SHALL 共有可能なURLを提供する
2. WHEN 他のユーザーが共有されたURLにアクセスする THEN Linker SHALL そのプロフィールの詳細ページを表示する
3. WHEN プロフィールが存在しないURLにアクセスする THEN Linker SHALL 「プロフィールが見つかりません」というメッセージを表示する
4. WHEN ユーザーがプロフィールページで共有ボタンをクリックする THEN Linker SHALL URLをクリップボードにコピーする

### 要件 9: ユーザーインターフェース

**ユーザーストーリー:** エンジニアとして、使いやすく見やすいインターフェースを期待するので、快適にプラットフォームを利用したい。

#### 受け入れ基準

1. WHEN ユーザーがサイトにアクセスする THEN Linker SHALL レスポンシブデザインでモバイルとデスクトップの両方に対応する
2. WHEN フォームにバリデーションエラーがある THEN Linker SHALL 各フィールドの近くに明確なエラーメッセージを表示する
3. WHEN ユーザーがナビゲーションメニューを使用する THEN Linker SHALL プロフィール作成と自分のプロフィールへのリンクを提供する
4. WHEN データの読み込みや保存が行われる THEN Linker SHALL ローディング状態を視覚的に表示する

### 要件 10: プロフィール削除

**ユーザーストーリー:** エンジニアとして、自分のプロフィールを削除したいので、プラットフォームから退出できるようにしたい。

#### 受け入れ基準

1. WHEN ログイン済みユーザーが自分のプロフィールページで削除ボタンをクリックする THEN Linker SHALL 削除確認ダイアログを表示する
2. WHEN ユーザーが削除を確認する THEN Linker SHALL プロフィールをSupabaseデータベースから削除する
3. WHEN プロフィールが削除される THEN Linker SHALL ユーザーをホームページにリダイレクトする
4. WHEN ユーザーが削除をキャンセルする THEN Linker SHALL プロフィールを保持してプロフィールページに留まる

### 要件 11: プロフィール所有者認証

**ユーザーストーリー:** エンジニアとして、自分が作成したプロフィールのみを編集・削除できるようにしたいので、他の人に勝手に変更されないようにしたい。

#### 受け入れ基準

1. WHEN プロフィールが作成される THEN Linker SHALL ログイン中のユーザーIDをプロフィールの所有者として記録する
2. WHEN ログインしていないユーザーがプロフィールページを閲覧する THEN Linker SHALL 編集ボタンと削除ボタンを非表示にする
3. WHEN ログイン済みユーザーが他人のプロフィールページを閲覧する THEN Linker SHALL 編集ボタンと削除ボタンを非表示にする
4. WHEN ログイン済みユーザーが自分のプロフィールページを閲覧する THEN Linker SHALL 編集ボタンと削除ボタンを表示する
5. WHEN Supabaseデータベースにアクセスする THEN Linker SHALL Row Level Security (RLS)を使用してユーザーが自分のプロフィールのみを編集・削除できるように制限する
6. WHEN ユーザーが別のデバイスからログインする THEN Linker SHALL 同じプロフィールの編集・削除権限を持つ

### 要件 12: プロフィール画像管理

**ユーザーストーリー:** エンジニアとして、プロフィールに自分の写真を追加したいので、より個人的で親しみやすいプロフィールを作成したい。

#### 受け入れ基準

1. WHEN ユーザーがプロフィールフォームで画像アップロードボタンをクリックする THEN Linker SHALL ファイル選択ダイアログを表示する
2. WHEN ユーザーが画像ファイルを選択する THEN Linker SHALL 画像のプレビューを表示する
3. WHEN ユーザーが5MBを超える画像をアップロードしようとする THEN Linker SHALL エラーメッセージを表示してアップロードを防止する
4. WHEN ユーザーが画像以外のファイルをアップロードしようとする THEN Linker SHALL エラーメッセージを表示してアップロードを防止する
5. WHEN プロフィールが保存される THEN Linker SHALL 画像をSupabase Storageの`profile-images`バケットにアップロードする
6. WHEN 画像がアップロードされる THEN Linker SHALL 一意のファイル名（ユーザーID + タイムスタンプ）で保存する
7. WHEN 既存の画像がある状態で新しい画像をアップロードする THEN Linker SHALL 古い画像をSupabase Storageから削除する
8. WHEN プロフィールが削除される THEN Linker SHALL 関連する画像もSupabase Storageから削除する
9. WHEN 画像のアップロードに失敗する THEN Linker SHALL エラーメッセージを表示してプロフィール保存を継続する（画像なしで保存）
10. WHEN ユーザーが画像を削除する THEN Linker SHALL プロフィールからimage_urlを削除してSupabase Storageから画像を削除する
